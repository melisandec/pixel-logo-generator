generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
}

model LeaderboardEntry {
  id           String   @id
  text         String
  seed         Int
  imageUrl     String   // Legacy field - use logoImageUrl or cardImageUrl based on context
  logoImageUrl String?  // Raw pixel logo (no frame, no UI, just the art)
  cardImageUrl String?  // Social sharing card (frame, rarity, branding)
  username     String
  displayName  String
  pfpUrl       String
  likes        Int      @default(0)
  recasts      Int      @default(0)
  rarity       String?
  presetKey    String?
  createdAt    DateTime @default(now())
  castUrl      String?

  @@index([createdAt])
  @@index([username])
}

model Badge {
  id          String   @id @default(cuid())
  userId      String
  badgeType   String
  earnedAt    DateTime @default(now())
  metadata    Json?

  @@index([userId])
  @@index([badgeType])
  @@unique([userId, badgeType])
}

model ChallengeCompletion {
  id          String   @id @default(cuid())
  userId      String
  challengeId String
  date        DateTime
  prompts     String[]
  completedAt DateTime @default(now())

  @@unique([userId, challengeId])
  @@index([userId, date])
}

model DailyWinner {
  id            String   @id @default(cuid())
  date          DateTime  @unique
  winner1Id     String
  winner1EntryId String
  winner2Id     String?
  winner2EntryId String?
  winner3Id     String?
  winner3EntryId String?

  @@index([date])
}

model Feedback {
  id        String   @id @default(cuid())
  userId    String?
  username  String?
  type      String   // bug, feature, ux, praise, other
  message   String
  rating    Int?
  createdAt DateTime @default(now())
  status    String   @default("new") // new, reviewed, resolved

  @@index([createdAt])
  @@index([status])
}

model Analytics {
  id        String   @id @default(cuid())
  eventType String   // generation, share, search, etc.
  userId    String?
  username  String?
  metadata  Json?    // seed, text, rarity, etc.
  createdAt DateTime @default(now())

  @@index([eventType])
  @@index([createdAt])
  @@index([userId])
}

model UserPreferences {
  id              String   @id @default(cuid())
  userId          String   @unique
  username        String   @unique
  uiMode          String   @default("simple") // simple or advanced
  onboardingDone  Boolean  @default(false)
  soundEnabled    Boolean  @default(true)
  updatedAt       DateTime @updatedAt

  @@index([username])
}
